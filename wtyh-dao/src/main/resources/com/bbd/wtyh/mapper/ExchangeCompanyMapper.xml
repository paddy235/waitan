<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bbd.wtyh.mapper.ExchangeCompanyMapper">


    <select id="queryExchangeCompanyCategory" resultType="java.util.Map">
			SELECT
				`status`,
				COUNT(company_id) as number
			FROM
				exchange_company
			GROUP BY
				`status`
	</select>

	<select id="queryExchangeCompanyArea"  resultType="com.bbd.wtyh.domain.vo.ExchangeCompanyAreaVO">
			SELECT
				a.`name` as name,
				COUNT(c.company_id) as count
			FROM
				exchange_company ec
			LEFT JOIN company c ON ec.company_id = c.company_id
			LEFT JOIN area a ON c.area_id = a.area_id
			WHERE
				1 = 1
			AND c.area_id > 0
			GROUP BY
				a.area_id
	</select>

	<select id="queryExchangeCompanyByStatus" parameterType="java.lang.Integer" resultType="com.bbd.wtyh.domain.vo.ExchangeCompanyVO">
		SELECT
			c.`name` as name,
			ec.approve_department as approveDepartment ,
			ec.supervise_department as superviseDepartment,
			c.legal_person as legalPerson,
			ec.website as website
		FROM
			exchange_company ec
		LEFT JOIN company c ON ec.company_id = c.company_id
		<where>
			1=1
			<if test="status > 0">
				and ec.`status` = #{status}
			</if>
		</where>
	</select>

	<select id="queryExchangeCompanyListByAreaId" parameterType="java.util.Map" resultType="com.bbd.wtyh.domain.vo.ExchangeCompanyVO">
		SELECT
			c.`name`,
			c.address,
			c.registered_capital as registeredCapital,
			c.legal_person as legalPerson,
			c.registered_date as registeredDate,
			ec.website as website,
			c.risk_level AS riskLevel
		FROM
			exchange_company ec
		LEFT JOIN company c ON ec.company_id = c.company_id
		LEFT JOIN area a ON c.area_id = a.area_id
		WHERE
			1=1
		<if test="type != null and type > 0">
			and ec.type = #{type}
		</if>
		<if test="areaName != null and areaName != ''">
			and a.name = #{areaName}
		</if>
		<if test="orderName == 'registeredCapital'">
			ORDER BY
			c.registered_capital
		</if>
		<if test="orderName == 'registeredDate'">
			ORDER BY
			c.registered_date
		</if>
		<if test="orderType == 'desc'">
			DESC
		</if>
		<if test="orderType == 'asc'">
			ASC
		</if>

	</select>

</mapper>